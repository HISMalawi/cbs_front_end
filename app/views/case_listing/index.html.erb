<%= stylesheet_link_tag 'octopus/select2', rel: 'stylesheet' %>
<%= stylesheet_link_tag 'octopus/datatables' %>

<%= stylesheet_link_tag 'octopus/jquery-ui-1.10.4.custom', rel: 'stylesheet' %>
<%= stylesheet_link_tag 'octopus/bootstrap-multiselect', rel: 'stylesheet' %>
<%= stylesheet_link_tag 'octopus/bootstrap-tagsinput', rel: 'stylesheet' %>
<%= stylesheet_link_tag 'octopus/bootstrap-colorpicker', rel: 'stylesheet' %>
<%= stylesheet_link_tag 'octopus/bootstrap-timepicker', rel: 'stylesheet' %>
<%= stylesheet_link_tag 'octopus/basic', rel: 'stylesheet' %>
<%= stylesheet_link_tag 'octopus/dropzone', rel: 'stylesheet' %>
<%= stylesheet_link_tag 'octopus/bootstrap-markdown.min', rel: 'stylesheet' %>
<%= stylesheet_link_tag 'octopus/summernote', rel: 'stylesheet' %>
<%= stylesheet_link_tag 'octopus/summernote-bs3', rel: 'stylesheet' %>
<%= stylesheet_link_tag 'octopus/codemirror', rel: 'stylesheet' %>
<%= stylesheet_link_tag 'octopus/monokai' %>
<%= stylesheet_link_tag 'octopus/pnotify.custom', rel: 'stylesheet' %>

<section class="panel">
  <header class="panel-heading">
    <h2 class="panel-title">Case Listing</h2>
  </header>

  <!-- Filter section -->
  <div class="panel-body" style="text-align: right;">
    <form class="form-horizontal form-bordered" id="filter-form">
      <div class="row">
        <div class="form-group col-lg-4" style="border: 0px;">
          <label class="col-md-3 control-label">District</label>
          <div class="col-md-6">
            <select class="form-control" data-plugin-multiselect id="district_id">
              <option value="1" selected>Lilongwe</option>
              <option value="2">Balaka</option>
              <option value="3">Mzuzu</option>
            </select>
          </div>
        </div>
        <div class="form-group col-lg-6" style="border: 0px;">
          <label class="col-md-3 control-label">ART Initiation Date Range</label>
          <div class="col-md-6">
            <div class="input-daterange input-group" data-plugin-datepicker>
														<span class="input-group-addon">
															<i class="fa fa-calendar"></i>
														</span>
              <input type="text" class="form-control" name="start" readonly="readonly" id="start_date">
              <span class="input-group-addon">to</span>
              <input type="text" class="form-control" name="end" readonly="readonly" id="end_date">
            </div>
          </div>
        </div>
        <div class="form-group col-lg-2">
          <button type="submit" class="btn btn-primary">Filter</button>
        </div>
      </div>
    </form>
  </div>
  <!-- end filter -->
</section>

<section class="panel">
  <div class="panel-body">
    <table class="table table-bordered table-striped" id="datatable-ajax">
      <thead>
      <tr>
        <th>Surveillance ID</th>
        <th> Gender</th>
        <th> Month of Birth</th>
        <th> HIV Test Date</th>
        <th> HIV Test Facility</th>
        <th> ART Initiation Date</th>
        <th> ART Regimen</th>
        <th> ART Facility</th>
        <th> Latest Viral Load Result</th>
        <th> Latest Viral Date</th>
        <th> Latest Viral Load Facility</th>
      </tr>
      </thead>
      <tbody>
      </tbody>
    </table>
  </div>
</section>


<section class="panel" style="visibility: hidden;">
  <div class="panel-body">
    <a id="open-form" class="modal-with-form btn btn-default" href="#modalForm" style="visibility: hidden;">Open Form</a>
  </div>
</section>

<!-- Modal Form -->
<div id="modalForm" class="modal-block modal-block-primary mfp-hide">
  <section class="panel">
    <header class="panel-heading">
      <h2 class="panel-title">
        Case Listing: Surveillance <span id="surv_id_header">#nbj176</span>
      </h2>
    </header>
    <div class="panel-body">
      <table class="table table-bordered table-striped" id="specific_case_profile_table">
        <tr>
          <th>Surveillance ID</th>
          <td id="surv_id">#nbj176</td>
        </tr>
        <tr>
          <th> Gender</th>
          <td id="gender">&nbsp;</td>
        </tr>
        <tr>
          <th> Month of Birth</th>
          <td id="month_of_birth">&nbsp;</td>
        </tr>
        <tr>
          <th> HIV Test Date</th>
          <td id="hiv_test_date">&nbsp;</td>
        </tr>
        <tr>
          <th> HIV Test Facility</th>
          <td id="hiv_test_facility">&nbsp;</td>
        </tr>
        <tr>
          <th> ART Initiation Date</th>
          <td id="art_init_date">&nbsp;</td>
        </tr>
        <tr>
          <th> ART Regimen</th>
          <td id="art_regimen">&nbsp;</td>
        </tr>
        <tr>
          <th> ART Facility</th>
          <td id="art_facility">&nbsp;</td>
        </tr>
        <tr>
          <th> Latest Viral Load Result</th>
          <td id="latest_vl_result">&nbsp;</td>
        </tr>
        <tr>
          <th> Latest Viral Date</th>
          <td id="latest_viral_date">&nbsp;</td>
        </tr>
        <tr>
          <th> Latest Viral Load Facility</th>
          <td id="latest_vl_facility">&nbsp;</td>
        </tr>
        <tr>
          <th> ART INIT (First Registered)</th>
          <td id="art_ini_first_reg">&nbsp;</td>
        </tr>
        <tr>
          <th> Entry into Care Date</th>
          <td id="entry_into_care_date">&nbsp;</td>
        </tr>
        <tr>
          <th> 1st CD4 Test Date</th>
          <td id="first_cd4_test_date">&nbsp;</td>
        </tr>
        <tr>
          <th> 1st Prescribed ART INIT Date</th>
          <td id="first_prescribed_art_init_date">&nbsp;</td>
        </tr>
        <tr>
          <th> 1st Viral Load Test Date</th>
          <td id="first_vl_test_date">&nbsp;</td>
        </tr>
        <tr>
          <th> Follow-Up Viral Load Test Date</th>
          <td id="follow_up_vl_test_date">&nbsp;</td>
        </tr>
        <tr>
          <th> Suppressed Viral Load Result (Low VL History)</th>
          <td id="suppressed_vl_result">&nbsp;</td>
        </tr>
        <tr>
          <th> Death Date</th>
          <td id="death_date">&nbsp;</td>
        </tr>
        <tr>
          <th> Cause of Death</th>
          <td id="cause_of_death">&nbsp;</td>
        </tr>
        <tr>
          <th> Staging Information</th>
          <td id="staging_info">&nbsp;</td>
        </tr>
        <tr>
          <th> Show Facility Movement(History)</th>
          <td id="facility_movement_history">&nbsp;</td>
        </tr>
        <tbody>
        </tbody>
      </table>
    </div>
    <footer class="panel-footer">
      <div class="row">
        <div class="col-md-12 text-right">
          <button class="btn btn-primary modal-confirm">Submit</button>
          <button class="btn btn-default modal-dismiss">Cancel</button>
        </div>
      </div>
    </footer>
  </section>
</div>

<%= javascript_include_tag 'octopus/select2' %>
<%= javascript_include_tag 'octopus/jquery.dataTables' %>
<%= javascript_include_tag 'octopus/datatables' %>

<%= javascript_include_tag 'octopus/jquery-ui-1.10.4.custom' %>
<%= javascript_include_tag 'octopus/jquery.ui.touch-punch' %>
<%= javascript_include_tag 'octopus/bootstrap-multiselect' %>
<%= javascript_include_tag 'octopus/jquery.maskedinput' %>
<%= javascript_include_tag 'octopus/bootstrap-tagsinput' %>
<%= javascript_include_tag 'octopus/bootstrap-colorpicker' %>
<%= javascript_include_tag 'octopus/bootstrap-timepicker' %>
<%= javascript_include_tag 'octopus/spinner' %>
<%= javascript_include_tag 'octopus/dropzone' %>
<%= javascript_include_tag 'octopus/markdown' %>
<%= javascript_include_tag 'octopus/to-markdown' %>
<%= javascript_include_tag 'octopus/bootstrap-markdown' %>
<%= javascript_include_tag 'octopus/codemirror' %>
<%= javascript_include_tag 'octopus/active-line' %>
<%= javascript_include_tag 'octopus/matchbrackets' %>
<%= javascript_include_tag 'octopus/javascript' %>
<%= javascript_include_tag 'octopus/xml' %>
<%= javascript_include_tag 'octopus/htmlmixed' %>
<%= javascript_include_tag 'octopus/css' %>
<%= javascript_include_tag 'octopus/summernote' %>
<%= javascript_include_tag 'octopus/bootstrap-maxlength' %>
<%= javascript_include_tag 'octopus/ios7-switch' %>
<%= javascript_include_tag 'octopus/pnotify.custom' %>
<%= javascript_include_tag 'octopus/examples.modals' %>

<script>
    let $table = $('#datatable-ajax');
    var dtTable;

    $(document).ready( function () {
        dtTable = $table.dataTable();
    } );

    // process the form
    $('#filter-form').submit(function(event) {

        let formData = {
            'start_date' : $('#start_date').val(),// '1900-01-01',
            'end_date' : $('#end_date').val()// '2019-01-01'
        };

        $.ajax({
            type        : 'POST',
            url         : '/case_listing',
            headers : {
                'X-CSRF-Token': $('meta[name="csrf-token"]').attr('content')
            },
            data        : formData,
            dataType    : 'json',
            encode       : true
        })
        // using the done promise callback
            .done(function(data) {
                dtTable.fnClearTable();
                dtTable.fnDestroy();
                dtTable = $table.dataTable({
                    bProcessing: true,
                    data: data
                });
            });

        event.preventDefault();
    });

    // view case profile
    $($table).on('click', 'tbody tr', function() {
        //get textContent of the TD
        console.log('TD cell textContent : ', this);

        // $('.simple-ajax-modal').click();
        $('#open-form').click();
        /*
        Call the Ajax modal
        */
        // $('.simple-ajax-modal').magnificPopup({
        //     type: 'ajax',
        //     modal: true
        // });

    })
</script>
